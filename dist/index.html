<!DOCTYPE html><html lang=pt-BR><head><meta charset=utf-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1" name=viewport><title>Mapa do Bairro</title><link crossorigin=anonymous href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u rel=stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><style>body,html{height:100%;color:#333}body{padding-top:50px;font-family:Roboto,"Helvetica Neue",Helvetica,Arial,sans-serif}.navbar{margin-bottom:0}.marker-img-container{height:calc(100vh - 50px)}.marker-img{position:absolute;width:350px;max-width:75%;left:50%;top:50%;transform:translateX(-50%) translateY(-50%)}.col-aside,.map{padding:0}.map{height:calc(100vh - 50px)}.search-btn,.search-in{height:41px;border-radius:0}.overflow{overflow-y:auto}.marker-list{margin-bottom:0}.list-group-item:first-child{border-radius:0;border-top:0}.list-group-item:last-child{border-radius:0}.info{border-radius:0;border-top:0;margin-bottom:0}@media screen and (min-width:768px){.col-aside,.info{height:calc(100vh - 50px)}.marker-list{height:calc(100vh - 91px)}.navbar-collapse{width:25%}}.info-heading{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between}.info-close{font-size:.8em}.list-apis{font-size:.9em}.api-title{font-size:1.2em;font-weight:700;margin-top:.5em}.api-title-span{font-size:.7em;font-weight:lighter;color:#4b4b4b}.address{background-color:#f5f5f5}.list-places{padding-left:0;list-style:none}.list-places-item{cursor:pointer}.list-places-item:hover{color:#43434b;background-color:#dfdff6;font-weight:700}.photo{position:relative;margin:0;padding:0}.photo-img{width:100%;border:0}.flickr{position:absolute;top:calc(100% - 32px);left:calc(100% - 65px)}</style></head><body><nav class="navbar navbar-fixed-top navbar-inverse"><div class=container-fluid><button class="btn-hamburguer collapsed navbar-toggle" type=button aria-expanded=false data-target=.navbar-collapse data-toggle=collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href=#>Mapa do Bairro</a></div></nav><div class="container-fluid collapse error-img"><div class=row><div class=col-xs-12><div class=marker-img-container><img alt="Imagem marcador google maps" class=marker-img src=img/map-marker-small.svg></div></div></div></div><div class="container-fluid app-view"><div class=row><aside class="collapse col-aside col-sm-3 navbar-collapse" id=collapse><div class="input-group search" data-bind="with: search, visible: search.visible"><span class=input-group-btn><button class="btn btn-success search-btn" type=button><span class="glyphicon glyphicon-search" aria-hidden=true></span></button> </span><input class="form-control search-in" data-bind="textInput: text, event: {keyup: $root.markerList.filter}" placeholder="Filtrar resultados"></div><div class="list-group marker-list overflow" data-bind="foreach: markerList.items,visible: markerList.visible"><button class=list-group-item type=button data-bind="text: title,click: $root.markerList.click,event: {mouseover: $root.mouseOverIcon, mouseout: $root.mouseOutIcon},visible: filtered" name=button></button></div><div class="overflow info panel panel-default" data-bind="with: infoPanel, visible: infoPanel.visible"><div class="info-heading panel-heading"><span data-bind="text: title"></span> <button class="close info-close" type=button data-bind="click: close"><span class="glyphicon glyphicon-remove" aria-hidden=true></span></button></div><ul class="list-group list-apis"><li class="list-group-item photo" data-bind="visible: photo"><img alt="" class="img-responsive photo-img" data-bind="attr: {src: photo}"> <img alt="Flickr logo" class=flickr data-bind="visible: flickr" src=https://s.yimg.com/pw/images/goodies/white-flickr.png></li><li class="list-group-item address" data-bind="text: address, visible: address"></li><li class="list-group-item wiki" data-bind="visible: wiki"><h3 class=api-title>Wikipédia</h3><p data-bind="text: wiki"></p></li><li class="list-group-item places" data-bind="visible: places.items().length > 0"><h3 class=api-title>Google Places <span class=api-title-span>Clique para ver</span></h3><ul class=list-places data-bind="foreach: places.items"><li class=list-places-item data-bind="text: marker.title, click: $parent.places.click"></li></ul></li></ul></div></aside><main class="col-sm-9 map" id=map></main></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js crossorigin=anonymous integrity="sha256-owX7sroiO/O1a7h3a4X29A1g3QgqdNvijRQ7V5TH45M="></script><script src=https://code.jquery.com/jquery-3.2.1.min.js crossorigin=anonymous integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js crossorigin=anonymous integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa></script><script>function app(){"use strict";function e(){var e=this;e.search={text:ko.observable(""),visible:ko.observable(!0),reset:function(){this.text(""),e.markerList.showAll(!0)}},e.markerList={items:ko.observableArray([]),visible:ko.observable(!0),showAll:function(e){this.items().forEach(function(t){t.setVisible(e)})},filter:function(t,o){if(27===o.keyCode)e.search.reset();else{var i=e.search.text().toLowerCase();e.markerList.items().forEach(function(e){-1!==e.title.toLowerCase().indexOf(i)?e.setVisible(!0):e.setVisible(!1)})}},click:function(o){t(o),f(o),m(),e.search.reset(),e.places.reset(),o.getPlaces(),e.infoPanel.update(o),e.infoPanel.open()}},e.places={items:ko.observableArray([]),click:function(o){var i=null;t(i=o.hasOwnProperty("marker")?o.marker:o),f(i),m(),e.infoPanel.update(i)},reset:function(){this.items().forEach(function(e){e.marker.setVisible(!1)}),this.items([])}},e.infoPanel={title:ko.observable(""),photo:ko.observable(""),flickr:ko.observable(!1),wiki:ko.observable(""),address:ko.observable(""),places:e.places,visible:ko.observable(!1),reset:function(){this.title(""),this.photo(""),this.flickr(!1),this.wiki(""),this.address("")},update:function(e){this.reset(),this.title(e.title),this.flickr(e.photo.match("flickr")),this.photo(e.photo),this.address(e.address),this.wiki(e.wiki)},toggle:function(){this.visible(e.markerList.visible()),e.markerList.visible(!this.visible())},close:function(){e.search.reset(),e.search.visible(!0),d.close(),this.reset(),this.places.reset(),this.toggle(),h.fitBounds(g)},open:function(){e.search.visible(!1),e.markerList.visible(!1),this.visible(!0)}},e.mouseOverIcon=function(e){e.setIcon(w.BLUE)},e.mouseOutIcon=function(e){e.setIcon(w.RED)}}function t(e){d.setContent(o(e.title)),d.open(h,e)}function o(e){return e.toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})}function i(e){var t={location:e.position,radius:"500"};return new Promise(function(i,s){k.nearbySearch(t,function(t,n){if(n===google.maps.places.PlacesServiceStatus.OK){for(var r=[],p=a(["bar","restaurant","food","lodging"],t),f=0;f<p.length;f++){var m=p[f],h=o(m.name),g=m.geometry.location,d=l(m.photos),k=m.rating;if(d&&g&&g!==e.getPosition()){var b=u({title:h,position:m.geometry.location,animation:google.maps.Animation.DROP,icon:w.GREEN});if(b.type="placeItem",b.photo=d,b.getAddress(),r.push({marker:b,rating:k}),r.length>=10)break}}c(r),i(r)}else s(Error("a API do Google Places não está disponível nesse momento"))})})}function s(e){var t="https://api.flickr.com/services/rest/?"+"method=%method%&api_key=%api_key%&text=%text%&license=%license%&content_type=%content_type%&per_page=%per_page%&format=%format%&sort=%sort%&extras=%extras%&nojsoncallback=1".replace(/%method%/,"flickr.photos.search").replace(/%api_key%/,"e7578e7c5110616e04eb5e44bcc7a892").replace(/%text%/,e+" Buenos Aires").replace(/%license%/,"1,2,3,4,5,6,7").replace(/%content_type%/,1).replace(/%per_page%/,10).replace(/%format%/,"json").replace(/%sort%/,"").replace(/%extras%/,"url_m");return new Promise(function(e,o){$.ajax({url:t,dataType:"json"}).done(function(t){if(t)for(var o=0;o<t.photos.photo.length;o++){var i=t.photos.photo[o];if(Number(i.height_m)<Number(i.width_m)){e(i.url_m);break}}}).fail(function(){o(Error("a API do Flickr não está disponível nesse momento!"))})})}function n(e){var t="https://es.wikipedia.org/w/api.php?"+"format=%format%&action=%action%&search=%search%&limit=%limit%&callback=?".replace(/%format%/,"json").replace(/%action%/,"opensearch").replace(/%search%/,e).replace(/%limit%/,1);return new Promise(function(e,o){$.ajax({url:t,dataType:"jsonp"}).done(function(t){t?e(t[2][0]):o(Error("Wikipedia error"))}).fail(function(){o(Error("a API da Wikipédia não está disponível nesse momento!"))})})}function r(e){return new Promise(function(t,o){b.geocode({location:e},function(i,s){s===google.maps.GeocoderStatus.OK?i[1]&&t(i[0].formatted_address):s===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?setTimeout(function(){r(e).then(function(e){t(e)},function(e){o(e)})},2e3):o(Error("Geocoder status: "+s))})})}function a(e,t){return t.filter(function(t){return e.some(function(e){return-1!==t.types.indexOf(e)})})}function l(e){if(e&&"undefined"!==e)return e[0].getUrl({maxWidth:423})}function c(e){return e.sort(function(e,t){return e.marker.title<t.marker.title?-1:e.marker.title>t.marker.title?1:0})}function p(e){var t=new google.maps.LatLngBounds;t.extend(e.getPosition()),e.places.forEach(function(e){t.extend(e.marker.getPosition())}),h.fitBounds(t)}function u(e){var t=new google.maps.Marker(e),o=Object.create(t),a=Object.getPrototypeOf(o);return a.filtered=ko.observable(!0),a.photo="",a.address="",a.wiki="",a.places=[],a.type="",a.getWiki=function(){var e=this;n(this.title).then(function(t){e.wiki=t},function(e){alert(e)})},a.getAddress=function(){var e=this;r(this.position).then(function(t){e.address=t},function(e){alert(e)})},a.getPhoto=function(e){var t=this;"flickr"===e&&s(this.title).then(function(e){t.photo=e},function(e){alert(e)})},a.getPlaces=function(){var e=this;"listItem"===e.type&&0===e.places.length?i(e).then(function(t){e.places=t,P.places.items(e.places),p(e)},function(e){alert(e)}):(P.places.items(e.places),P.places.items().forEach(function(e){e.marker.setVisible(!0)}),p(e))},a.oldSetVisible=a.setVisible,a.setVisible=function(e){this.oldSetVisible(e),this.filtered(e)},o.setMap(h),o.setVisible(!0),o.addListener("click",function(){"placeItem"===this.type?P.places.click(this):"listItem"===this.type&&P.markerList.click(this)}),g.extend(o.position),o}function f(e){e.setZIndex(google.maps.Marker.MAX_ZINDEX),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},3e3)}function m(){var e=$(".col-aside");e.hasClass("in")&&e.removeClass("in")}var h=new google.maps.Map(document.getElementById("map")),g=new google.maps.LatLngBounds,d=new google.maps.InfoWindow,k=new google.maps.places.PlacesService(h),b=new google.maps.Geocoder,v=[{title:"Casa Rosada",position:{lat:-34.608054,lng:-58.370286}},{title:"Plaza de Mayo",position:{lat:-34.608396,lng:-58.372164}},{title:"Museo Casa Rosada",position:{lat:-34.608706,lng:-58.369563}},{title:"Luna Park (Buenos Aires)",position:{lat:-34.602305,lng:-58.368752}},{title:"Puerto Madero",position:{lat:-34.605135,lng:-58.365641}},{title:"Plaza del Congreso",position:{lat:-34.609708,lng:-58.390334}},{title:"Obelisco de Buenos Aires",position:{lat:-34.603736,lng:-58.381573}},{title:"Teatro Colón",position:{lat:-34.601139,lng:-58.38315}},{title:"Galerías Pacífico",position:{lat:-34.599196,lng:-58.374867}},{title:"Centro Cultural Néstor Kirchner",position:{lat:-34.603495,lng:-58.369553}}],w={RED:"http://maps.google.com/mapfiles/ms/icons/red-dot.png",BLUE:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png",GREEN:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"},P=new e;ko.applyBindings(P),function(){v.forEach(function(e){var t=u(e);t.type="listItem",t.getWiki(),t.getAddress(),t.getPhoto("flickr"),t.setIcon(w.RED),P.markerList.items.push(t)}),h.setZoom(18),h.fitBounds(g)}()}function googleApiError(){"use strict";$(".app-view").hide(),$(".error-img").show(),setTimeout(function(){alert("Google Maps não está disponível nesse momento.")},100)}</script><script src="https://maps.googleapis.com/maps/api/js?v=3&language=pt&region=BR&libraries=places&key=AIzaSyCLNwLl2L9wgxYlVc7HYndbk6T0a_AWWac&callback=app" async defer onerror=googleApiError()></script></body></html>